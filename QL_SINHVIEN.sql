use master
go
create database QL_SINHVIEN
GO
use QL_SINHVIEN
go

CREATE TABLE KHOA
(
	MAKH CHAR(2) NOT NULL,
	TENKHOA NVARCHAR(40)
)

CREATE TABLE LOP
(
	MALOP CHAR(10) NOT NULL,
	TENLOP NVARCHAR(40),
	SISO INT,
	LOPTRUONG CHAR(5),
	MAKH CHAR(2)
)

CREATE TABLE SINHVIEN
(
	MASV CHAR(6) NOT NULL,
	HOTEN NVARCHAR(40),
	NGSINH DATE,
	GTINH NVARCHAR(5),
	DIACHI NVARCHAR(40),
	MALOP CHAR(10),
)

CREATE TABLE GIANGVIEN
(
	MAGV CHAR(6)  NOT NULL,
	TENGV NVARCHAR(40),
	MAKH CHAR(2)
)

CREATE TABLE MONHOC
(
	MAMH CHAR(6) NOT NULL,
	TENMH NVARCHAR(40),
	SOTC INT
)

CREATE TABLE DIEM
(
	MASV CHAR(6) NOT NULL,
	MAMH CHAR(6) NOT NULL,
	LANTHI INT NOT NULL, 
	DIEMTHI INT
)



CREATE TABLE GIANGDAY
(
	MAGV CHAR(6) NOT NULL,
	MAMH CHAR(6) NOT NULL,
	NAMHOC CHAR(10),
	HOCKY INT
)

CREATE TABLE THANNHAN
(
	MATN CHAR(6) NOT NULL,
	HOTEN NVARCHAR(40),
	GIOITINH NVARCHAR(5)
)


CREATE TABLE QUANHE
(
	MATN CHAR(6) NOT NULL,
	MASV CHAR(6) NOT NULL,
	QUANHE NVARCHAR(10) NOT NULL
)

ALTER TABLE KHOA
ADD CONSTRAINT PK_KHOA PRIMARY KEY(MAKH)

ALTER TABLE LOP
ADD CONSTRAINT PK_LOP PRIMARY KEY(MALOP)

ALTER TABLE LOP
ADD CONSTRAINT FK_LOP_KHOA FOREIGN KEY(MAKH) REFERENCES KHOA(MAKH)

ALTER TABLE SINHVIEN
ADD CONSTRAINT PK_SINHVIEN PRIMARY KEY(MASV)

ALTER TABLE SINHVIEN
ADD CONSTRAINT FK_SINHVIEN_LOP FOREIGN KEY(MALOP) REFERENCES LOP(MALOP)

ALTER TABLE GIANGVIEN
ADD CONSTRAINT PK_GIANGVIEN PRIMARY KEY(MAGV)

ALTER TABLE GIANGVIEN
ADD CONSTRAINT FK_GIANGVIEN_KHOA FOREIGN KEY(MAKH) REFERENCES KHOA(MAKH)

ALTER TABLE MONHOC
ADD CONSTRAINT PK_MONHOC PRIMARY KEY(MAMH)

ALTER TABLE DIEM
ADD CONSTRAINT FK_DIEM_SINHVIEN FOREIGN KEY(MASV) REFERENCES SINHVIEN(MASV)

ALTER TABLE DIEM
ADD CONSTRAINT FK_DIEM_MONHOC FOREIGN KEY(MAMH) REFERENCES MONHOC(MAMH)

ALTER TABLE DIEM
ADD CONSTRAINT PK_DIEM PRIMARY KEY(MASV, MAMH, LANTHI)



ALTER TABLE GIANGDAY
ADD CONSTRAINT FK_GIANGDAY_GIANGVIEN FOREIGN KEY(MAGV) REFERENCES GIANGVIEN(MAGV)

ALTER TABLE GIANGDAY
ADD CONSTRAINT FK_GIANGDAY_MONHOC FOREIGN KEY(MAMH) REFERENCES MONHOC(MAMH)

ALTER TABLE GIANGDAY
ADD CONSTRAINT PK_GIANGDAY PRIMARY KEY(MAGV, MAMH)

ALTER TABLE THANNHAN
ADD CONSTRAINT PK_THANNHAN PRIMARY KEY(MATN)

ALTER TABLE QUANHE
ADD CONSTRAINT FK_QUANHE_THANNHAN FOREIGN KEY(MATN) REFERENCES THANNHAN(MATN)

ALTER TABLE QUANHE
ADD CONSTRAINT FK_QUANHE_SINHVIEN FOREIGN KEY(MASV) REFERENCES SINHVIEN(MASV)

ALTER TABLE QUANHE
ADD CONSTRAINT PK_QUANHE PRIMARY KEY(MATN, MASV, QUANHE)

SET DATEFORMAT dmy

SELECT * FROM KHOA

INSERT INTO KHOA
VALUES 
('SH', N'Công nghệ sinh học'),
('TH', N'Công nghệ thông tin'),
('TP', N'Công nghệ thực phẩm'),
('QT', N'Quản trị kinh doanh'),
('TC', N'Tài chính kế toán')


SELECT * FROM LOP
update LOP set MALOP ='10DHSH4', TENLOP = N'448sfds', MAKH = 'SH' WHERE MALOP ='10DHSH4';
INSERT INTO LOP
VALUES
('10DHSH1', N'10 Đại học Sinh học 1', 55, 'SV008', 'SH'),
('10DHTH1', N'10 Đại học Tin học 1', 50, 'SV001', 'TH'),
('11DHTH2', N'11 Đại học Tin học 2', 40, 'SV005', 'TH'),
('12DHTC1', N'12 Đại học Tài chính 1', 75, 'SV009', 'TC'),
('12DHTP1', N'12 Đại học Thực phẩm 1', 60, 'SV007', 'TP');

SELECT * FROM SINHVIEN



INSERT INTO SINHVIEN
VALUES
('SV001', N'Trần Lệ Quyên', '21/01/1995', N'Nữ', N'TPHCM', '10DHTH1'),
('SV002', N'Nguyễn Thế Bình', '04/06/1996', N'Nam', N'Tây Ninh', '11DHTH2'),
('SV003', N'Tô Ánh Nguyệt', '02/05/1995', N'Nữ', N'Vũng Tàu', '12DHTP1'),
('SV004', N'Nguyễn Thế Anh', '15/12/1996', N'Nam', N'Đồng Nai', '12DHTP1'),
('SV005', N'Lê Thanh Bình', '09/12/1994', N'Nam', N'Long An', '10DHTH1'),
('SV006', N'Phạm Quang Hậu', '12/10/1995', N'Nam', N'Tây Ninh', '10DHTH1'),
('SV007', N'Lê Cẩm Tú', '13/02/1989', N'Nữ', N'Bình Thuận', '12DHTP1'),
('SV008', N'Trương Thế Sang', '04/4/1993', N'Nam', N'Bình Dương', '10DHSH1'),
('SV009', N'Đậu Quang Ánh', '03/12/1994', N'Nam', N'Long An', '12DHTC1'),
('SV010', N'Huỳnh Kim Chi', '18/10/1965', N'Nữ', N'TPHCM', '11DHTH2'),
('SV011', N'Trịnh Đình Ánh', '15/11/1995', N'Nam', N'Bình Thuận', '10DHTH1');


SELECT * FROM GIANGVIEN

INSERT INTO GIANGVIEN
VALUES
('GV001', N'Phạm Thế Bảo', 'TH'),
('GV002', N'Lê Thế Truyền', 'TH'),
('GV003', N'Trương Anh Dũng', 'SH'),
('GV004', N'Bùi Chí Anh', 'TC'),
('GV005', N'Lê Công Hậu', 'QT'),
('GV006', N'Lê trung Thành', 'TP')

SELECT * FROM MONHOC

INSERT INTO MONHOC
VALUES
('CSDL', N'Cơ sở dữ liệu', 3),
('KTLT', N'Kỹ thuật lập trình', 3),
('THVP', N'Tin học văn phòng', 3),
('TRR', N'Toán rời rạc', 3),
('TTNT', N'Trí tuệ nhân tạo', 2),
('TTQT', N'Thanh toán quốc tế', 2)


SELECT * FROM DIEM

INSERT INTO DIEM
VALUES
('SV001', 'CSDL', 1, 9),
('SV002', 'THVP', 1, 3),
('SV002', 'THVP', 2, 7),
('SV004', 'THVP', 1, 6),
('SV004', 'TTQT', 1, 5),
('SV005', 'CSDL', 1, 3),
('SV005', 'CSDL', 2, 6),
('SV006', 'KTLT', 1, 4),
('SV009', 'TTQT', 1, 4),
('SV010', 'THVP', 1, 8),
('SV010', 'TRR', 1, 7);

update DIEM 
set MASV = 'SV001', MAMH = 'TRR', LANTHI =1 , DIEMTHI =8 
WHERE MASV='SV001' and MAMH='TRR' and LANTHI=1 

SELECT * FROM GIANGDAY

INSERT INTO GIANGDAY
VALUES
('GV001', 'CSDL', '2021-2022', 1),
('GV001', 'KTLT', '2020-2021', 2),
('GV001', 'TTNT', '2020-2021', 1),
('GV002', 'CSDL', '2021-2022', 2),
('GV002', 'KTLT', '2021-2022', 2)

SELECT * FROM THANNHAN

INSERT INTO THANNHAN
VALUES
('TN001', N'Nguyễn Thế Thành', N'Nam'),
('TN002', N'Tô Ánh Hồng', N'Nữ'),
('TN003', N'Lê Thanh An', N'Nam'),
('TN004', N'Phạm Thanh Tiền', N'Nữ'),
('TN006', N'Đậu Văn Thanh', N'Nam'),
('TN007', N'Nguyễn Thị Ánh', N'Nữ'),
('TN008', N'Lê Quang Định', N'Nam'),
('TN009', N'Huỳnh Văn Tư', N'Nam');

SELECT * FROM QUANHE

INSERT INTO QUANHE
VALUES
('TN001', 'SV002', N'Bố'),
('TN003', 'SV005', N'Bố'),
('TN004', 'SV007', N'Mẹ'),
('TN006', 'SV009', N'Bố'),
('TN007', 'SV002', N'Mẹ'),
('TN008', 'SV005', N'Bố'),
('TN008', 'SV007', N'Bố');


--Select * from LOP
--Select * from SINHVIEN
--SELECT *
--FROM SINHVIEN, LOP
--WHERE SINHVIEN.MALOP = LOP.MALOP